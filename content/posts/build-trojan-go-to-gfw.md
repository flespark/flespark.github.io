---
title: "ç§‘å­¦ä¸Šç½‘æŠ˜è…¾ç¬”è®°"
date: 2022-10-27T19:54:03+08:00
draft: false
---

ä»¥å‰åŸºäºVMESSçš„IPç›´è¿è£¸å¥”é…ç½®ç®€å•æ­å»ºäº†ä¸€ä¸ªæœºåœºï¼Œä½¿ç”¨çš„[æ¬ç“¦å·¥](https://bandwagonhost.com/)GIA CN2çº¿è·¯ï¼Œé€Ÿåº¦å’Œç¨³å®šæ€§ä¹Ÿéƒ½è¿˜å¯ä»¥ï¼Œæ²¡æœ‰æ—¶é—´æ£é¼“å°±è¿™æ ·ä¸€ç›´ç”¨äº†ä¸€å¹´å¤šã€‚ä½†æ˜¯å‡ ä¸ªæœˆå‰æŒ‚æœºåœºç™»é™†äº†ä¸€æ¬¡æ˜Ÿé™…äº‰éœ¸æ— ç«¯è¢«å°äº†åŠä¸ªæœˆï¼Œå‰é˜µå­å›½åº†æœŸé—´IPåˆè¢«å°äº†ã€‚çªç„¶googleä¸èƒ½ç”¨äº†è¿˜æ˜¯éå¸¸å½±å“å·¥ä½œå’Œå­¦ä¹ æ•ˆç‡ï¼Œæ‰€ä»¥å†³å®šèŠ±ç‚¹æ—¶é—´å­¦ä¹ ç½‘ç»œç›¸å…³çŸ¥è¯†ï¼Œå¥½å¥½å‡çº§ä¸€ä¸‹æœºåœºé…ç½®ã€‚æŠ€æœ¯é€‰å‹æ–¹é¢ï¼Œå› ä¸ºIPè¢«å°äº†ï¼Œä¹Ÿä¸èƒ½ç­‰åˆ°è§£å°ï¼Œå°±åªèƒ½èµ°Cloudflareçš„å…è´¹CDNäº†ï¼Œè€Œä¸”ä¸ºé¿å…å†æ¬¡è¢«å°ï¼Œé€‰æ‹©äº†ä¼ªè£…æ€§æ›´å¥½çš„trojan-goåè®®ã€‚ç›¸æ¯”åŸå…ˆçš„çº¿è·¯ï¼Œæ–°çš„æ–¹æ¡ˆæµé‡éƒ½è¦ç»è¿‡CDNä»£ç†ï¼ŒåŸæœ¬ä»¥ä¸ºä¼šæ…¢ä¸€äº›ï¼Œä½†æ˜¯å®æµ‹å‘ç°å»¶è¿Ÿåè€Œæœ‰æ‰€é™ä½è€Œä¸”è·‘é«˜é€Ÿæµé‡æ›´åŠ ç¨³å®šã€‚trojan-goçš„æµè¡Œç¨‹åº¦è¿œä¸å¦‚V-projectå®¶æ—äº§å“ï¼Œç½‘ä¸Šèƒ½æ‰¾åˆ°å¯é çš„æ–‡æ¡£ç›¸å¯¹è¾ƒå°‘ï¼Œä¸€æ­¥æ­¥è¾¹å­¦ä¹ è¾¹é…ç½®ä¸‹æ¥ä¹ŸèŠ±äº†ä¸å°‘æ—¶é—´ï¼Œæœ‰å¿…è¦æ€»ç»“ä¸€ä¸‹æ•´ä¸ªè¿‡ç¨‹ã€‚ä¸‹æ¬¡å‡ºä»€ä¹ˆé—®é¢˜æ—¶éœ€è¦é‡æ–°æ­å»ºæ—¶ä¹Ÿå¯ä»¥ä½œä¸ºå‚è€ƒï¼Œè™½ç„¶ç†è®ºä¸Šåªæœ‰SNIæ±¡æŸ“å¯¼è‡´æœºåœºå¤±æ•ˆæ¢ä¸€ä¸ªåŸŸåå°±èƒ½è§£å†³çš„ã€‚

### è¿œç«¯è½¯ä»¶é…ç½®

è¿œç«¯è½¯ä»¶é…ç½®çš„åŒ…æ‹¬è´­ä¹°VPSï¼ŒåŸŸåå’Œå¯¹åº”SSLè¯ä¹¦çš„ç”³è¯·ï¼ŒVPSä»£ç†æœåŠ¡ä»¥åŠCloudflareçš„é…ç½®ã€‚VPSå°±æ€§ä»·æ¯”å’Œç¨³å®šæ€§è€Œè¨€å¯ä»¥é€‰æ‹©æ¬ç“¦å·¥ï¼Œå‡ºå£å¸¦å®½å’Œæµé‡åŸºæœ¬æ²¡æœ‰é™åˆ¶ï¼Œå¹´ä»˜240è½¯å¦¹å¸å·¦å³ã€‚è´­ä¹°åŸŸåé€‰æ‹©å›½å¤–çš„åŸŸåæ³¨å†Œå•†ï¼Œå“ªä¾¿å®œå°±ä»é‚£ä¹°ï¼Œ[Godaddy](https://godaddy.com/)æˆ–è€…[namecheap](https://www.namecheap.com/)æœ‰æœ€ä¾¿å®œçš„åå‡ å—é’±ç¬¬ä¸€å¹´ã€‚VPSå’ŒåŸŸåè´­ä¹°ç½‘ä¸Šæœ‰è®¸å¤šè¯¦ç»†åˆ†äº«å°±ä¸å±•å¼€è®¨è®ºï¼Œæ³¨å†ŒåŸŸåå®Œæˆåå°†åŸŸåè§£ææœåŠ¡ç»‘å®šåˆ°[Cloudflare](https://www.cloudflare.com/)ï¼Œè¿™é‡Œæˆ‘ä½¿ç”¨Godaddyæ³¨å†Œçš„åŸŸåã€‚

1. æ³¨å†Œç™»å½•Cloudflareåç‚¹å‡»å³ä¾§"Add a Site"

![202210311056828](/images/202210311056828.png)

2. è¾“å…¥æ³¨å†Œçš„åŸŸåç‚¹å‡»"Add site"

![202210311058949](/images/202210311058949.png)

3. é€‰æ‹©æœ€ä¸‹æ–¹çš„å…è´¹æ–¹æ¡ˆç‚¹å‡»"Continue"

![202210311100259](/images/202210311100259.png)

4. ä»€ä¹ˆä¹Ÿä¸ç”¨å¡«ç»§ç»­ç‚¹å‡»"Continueâ€ï¼Œæç¤ºå¿…é¡»å…ˆä¿®æ”¹DNSè®°å½•ï¼Œ"Confirm"ç»§ç»­

![202210311130236](/images/202210311130236.png)

![202210311131536](/images/202210311131536.png)

5. æ˜¾ç¤ºä¿®æ”¹çš„ç›®æ ‡DNSè§£ææœåŠ¡åœ°å€ï¼Œæ¥ä¸‹æ¥åˆ°Godaddyä¿®æ”¹DNSé…ç½®

![202210311133520](/images/202210311133520.png)

6. åœ¨GoddayåŸŸåæ³¨å†Œå®Œæˆä¹‹åç‚¹å‡»å¤´åƒ->"My Product"ï¼Œè¿›å»ç‚¹å‡»ä¸‹æ–¹åˆšåˆšæ³¨å†Œçš„åŸŸå

![202210311112960](/images/202210311112960.png)

![202210311113310](/images/202210311113310.png)

7. é€‰æ‹©"DNS"->"Manage Zones"è¿›å…¥ï¼Œå±•å¼€DNSé…ç½®

![202210311113007](/images/202210311113007.png)

![202210311116906](/images/202210311116906.png)

8. å¾€ä¸‹ç¿»æ‰¾åˆ°æ‰¾åˆ°åŸŸåè§£ææœåŠ¡é…ç½®ï¼Œç‚¹å‡»"Change"è¿›å»ç„¶åé€‰æ‹©"Enter my own nameservers"

![202210311119928](/images/202210311119928.png)

![202210311136612](/images/202210311136612.png)

9. å¡«å…¥Cloudflareæä¾›çš„DNSè§£ææœåŠ¡åœ°å€ï¼Œç‚¹å‡»"Save"ï¼Œç„¶ååœ¨æç¤ºæ¡†å‹¾é€‰ç¡®è®¤

![202210311149614](/images/202210311149614.png)

![202210311150281](/images/202210311150281.png)

10. ç„¶åå³ä¸Šè§’popupæç¤ºä¿®æ”¹æˆåŠŸï¼ŒDNSè§£æå·²è½¬ç§»åˆ°Cloudflareç®¡ç†

![202210311151893](/images/202210311151893.png)

11. å›åˆ°åŸæ¥çš„Cloadflareç•Œé¢ç‚¹å‡»ä¸‹æ–¹çš„"Done, check nameservers"ä»¥ç»§ç»­ã€‚åŸŸåæ¥å…¥Cloudflareåä¼šè¦æ±‚å®Œæˆä¸€äº›å®‰å…¨å’Œæµé‡åŠ é€Ÿç›¸å…³çš„åŸºç¡€é…ç½®ï¼Œè¿™äº›é…ç½®è·ŸæœºåœºåŠŸèƒ½æ²¡æœ‰ä»€ä¹ˆå…³ç³»ï¼Œç‚¹å‡»"Get started"åæ¯ä¸€æ­¥é€‰æ‹©é»˜è®¤å³å¯

![202211010910998](/images/202211010910998.png)

![202211010911843](/images/202211010911843.png)

ç»§ç»­Cloudflareé…ç½®ä¹‹å‰ï¼Œéœ€è¦ä¸ºæ³¨å†Œçš„åŸŸåç”³è¯·ä¸€ä¸ªå…è´¹çš„SSLè¯ä¹¦ã€‚å¤šæ•°å…è´¹çš„è¯ä¹¦ç”³è¯·ç½‘ç«™éƒ½æ˜¯é€šè¿‡[Letâ€™s Encrypt](https://letsencrypt.org/)ç­¾å‘çš„ï¼Œæˆ‘è¿™é‡Œä»¥[OHTTPS](https://www.ohttps.com/)ä¸ºä¾‹

1. æ³¨å†Œç™»å½•OHTTPSä¹‹åï¼Œåœ¨"è¯ä¹¦ç®¡ç†"ä¸­ç‚¹å‡»"åˆ›å»ºè¯ä¹¦"ï¼Œå¡«å…¥åŸŸåä¸‹ä¸€æ­¥

![202210311211923](/images/202210311211923.png)

2. æŒ‰è¦æ±‚å¤åˆ¶CNMAEè®°å½•å€¼ï¼Œéœ€è¦æ·»åŠ åˆ°Cloudflareçš„DNSè®°å½•ä¸­

![202210311212874](/images/202210311212874.png)

3. å›åˆ°Cloudflareé€‰æ‹©åˆšé…ç½®çš„åŸŸåï¼Œåœ¨DNSè®¾ç½®ä¸­æ–°å¢CNAMEè§£æè®°å½•ï¼Œ"Proxy status"é€‰æ‹©"DNS only"ï¼Œç‚¹å‡»"Save"

![202211010917809](/images/202211010917809.png)

4. è¿”å›OHTTPSçš„éªŒè¯åŸŸåç•Œé¢ï¼Œå…ˆéªŒè¯è§£æè®°å½•æ˜¯å¦ç”Ÿæ•ˆç„¶ååˆ›å»ºè¯ä¹¦ï¼ˆè§£æè®°å½•æœªç”Ÿæ•ˆå¯ä»¥å°è¯•DNSæˆæƒæ¨¡å¼ï¼‰

![202211010921151](/images/202211010921151.png)

5. æœ€åä¸‹è½½ç”Ÿæˆçš„3ä¸ªè¯ä¹¦åˆ°æœ¬åœ°ï¼Œå¾…ä¼šéœ€è¦ä¸Šä¼ åˆ°VPS

![202211010924472](/images/202211010924472.png)

æ¥ç€å°±æ˜¯åœ¨VPSä¸Šå®‰è£…trojan-goçš„æœºåœºæœåŠ¡ç«¯è½¯ä»¶ã€‚æœºåœºæœåŠ¡ä½¿ç”¨æ–°æ—§å“ªä¸ªLinuxå‘è¡Œç‰ˆåŸºæœ¬æ˜¯æ²¡æœ‰è¦æ±‚ï¼Œä½¿ç”¨æ—§çš„å‘ç‰ˆæœ¬ç³»ç»Ÿå¯¹äºCPUå’Œå†…å­˜çš„å ç”¨ä¼šç›¸å¯¹ä½ä¸€äº›ï¼Œä½†æ˜¯å¯èƒ½éœ€è¦æ‰‹åŠ¨ä¸‹è½½å’Œé…ç½®å®‰è£…åŒ…ï¼Œæ— æ³•ä½¿ç”¨BBRåŠ é€Ÿç­‰æ–°å†…æ ¸æ‰æœ‰åŠŸèƒ½ã€‚æ€»çš„æ¥è¯´å¯¹äºä¸ªäººç¿»å¢™é€‰æ–°é€‰æ—§æ€»çš„æ¥è¯´å¯¹äºä½¿ç”¨ä½“éªŒåŒºåˆ«ä¸å¤§ï¼Œé€‰æ‹©å£ç¢‘å¥½çš„VPSå•†å®¶è¿˜æœ‰æ°ªé‡‘èƒ½åŠ›æ‰æ›´é‡è¦ã€‚å…¶æ¬¡VPSçš„åœ°ç†ä½ç½®ä¹Ÿæ¯”è¾ƒé‡è¦ï¼Œé¦–å…ˆä¸œå—äºšè™½ç„¶å»¶è¿Ÿå¯é€‰çš„VPSä»·æ ¼éƒ½å¤ªé«˜ï¼Œé€‰æ‹©æ—¥æœ¬æµè§ˆNetflixä¸€äº›èµ„æºä¼šå—é™ï¼Œç¾å›½è¥¿æµ·å²¸åŸå¸‚ä¸€èˆ¬æ˜¯æœ€å¥½çš„é€‰æ‹©ï¼Œbwghostçš„CN2çº¿è·¯ä»·æ ¼ä¸é«˜é€Ÿåº¦è¿˜å¯ä»¥ï¼Œç¦»å¾ˆå¤šå¤§å…¬å¸çš„æœåŠ¡å™¨ä¹Ÿæ¯”è¾ƒè¿‘ã€‚æˆ‘çš„VPSçš„IPè¢«å°äº†ï¼Œè™½ç„¶bwghostæä¾›äº†ä¸€ä¸ªè¿œç¨‹ç™»å½•é¡µé¢è¿˜å¯ä»¥ç”¨ä½†æ˜¯å¤åˆ¶ç²˜è´´çš„åŸºæœ¬åŠŸèƒ½ä¹Ÿæ²¡æœ‰ï¼Œå»¶è¿Ÿå¤§æ“ä½œèµ·æ¥å¾ˆä¸æ–¹ä¾¿ã€‚æƒ³åˆ°Vulträ¸Šä½¿ç”¨VPSéƒ½æ˜¯æŒ‰æ—¶è®¡è´¹çš„ï¼Œæ‰€ä»¥æˆ‘å°±åœ¨Vulträ¸Šå¼€äº†ä¸€ä¸ªä¸´æ—¶çš„VPSä½œä¸ºè·³æ¿sshè¿æ¥åˆ°è¢«å°IPçš„VPSã€‚å†æ¬¡ä»¥æ¼”ç¤ºä¸ºç›®çš„ï¼Œä¸‹é¢çš„æ­¥éª¤éƒ½æ˜¯åœ¨Vultréƒ¨ç½²çš„Debian 11 VPSä¸Šæ“ä½œçš„

1.sshç™»é™†åé¦–å…ˆæ£€æŸ¥å‘è¡Œç‰ˆé»˜è®¤çš„é˜²ç«å¢™çŠ¶æ€ï¼ŒDebain 11ä½¿ç”¨ufwä½œä¸ºé˜²ç«å¢™ç®¡ç†å·¥å…·ï¼ŒæŒ‰éœ€æ‰“å¼€åé¢è¦ä½¿ç”¨åˆ°åˆ°çš„ç«¯å£

```bash
$ ufw status
Status: active

To                         Action      From
--                         ------      ----
22                         ALLOW       Anywhere
22 (v6)                    ALLOW       Anywhere (v6)

root@vultr:~# ufw allow 80,443
```

2.ä»githubï¼ˆæˆ–è€…githubé•œåƒç«™ï¼‰ç¡®è®¤æœ€æ–°trojan-goçš„releaseåŒ…ä¸‹è½½è·¯å¾„ï¼Œä¸‹è½½è§£å‹å¾—åˆ°trojan-goå¯æ‰§è¡Œæ–‡ä»¶æ”¾åˆ°é€‚å½“è·¯å¾„ï¼Œå®‰è£…nginx

```bash
$ wget https://github.com/p4gefau1t/trojan-go/releases/download/v0.10.6/trojan-go-linux-amd64.zip
$ unzip trojan-go-linux-amd64.zip
$ cp trojan-go /usr/bin/

$ apt install nginx -y
```

3.scpä¸Šä¼ å‰é¢çš„ç”³è¯·çš„è¯ä¹¦fullchain.ceræ–‡ä»¶å’Œkeyæ–‡ä»¶åˆ°VPSï¼Œç„¶åæ·»åŠ trojan-goå’Œnginxçš„é…ç½®æ–‡ä»¶ï¼Œæ‰‹åŠ¨æ·»åŠ trojan-goå¯åŠ¨é¡¹

```bash

# æ·»åŠ trojan-goæœåŠ¡ç«¯é…ç½®æ–‡ä»¶
$ mkdir -p /etc/trojan-go
$ cat <<-'EOF' >/etc/trojan-go/config.json
> {
  "run_type": "server",
  "log_level": 0,
  "local_addr": "0.0.0.0",
  "local_port": 443,
  "remote_addr": "127.0.0.1",
  "remote_port": 80,
  "password": ["s9cbH8&2m%xN"],
  "ssl": {
    "cert": "/usr/local/etc/ssl_certificates/dot4.xyz.fullchain.cer",
    "key": "/usr/local/etc/ssl_certificates/dot4.xyz.key",
    "fallback_port": 8080,
    "sni": "api.dot4.xyz"
  },
  "websocket": {
    "enabled": true,
    "path": "/passthrough",
    "host": "api.dot4.xyz"
  }
}
EOF

# æ·»åŠ nginxé…ç½®æ–‡ä»¶
$ cat <<-'EOF' >/etc/nginx/nginx.conf
> events {
    worker_connections 1024;
}

http {
    server {
        listen      80 default_server;
        server_name _;

        location / {
            root   /usr/share/nginx/html;
            index  index.html index.htm;
        }
    }

    server {
        listen 8080 http2;
        server_name _;
        return      400;
    }
}
EOF

# æ·»åŠ trojan-go systemdå¯åŠ¨é¡¹
$ cat <<'EOF' >/usr/lib/systemd/system/trojan-go.service
> # /usr/lib/systemd/system/trojan-go.service
[Unit]
Description=Trojan-Go - An unidentifiable mechanism that helps you bypass GFW
Documentation=https://p4gefau1t.github.io/trojan-go/
After=network.target nss-lookup.target

[Service]
User=nobody
CapabilityBoundingSet=CAP_NET_ADMIN CAP_NET_BIND_SERVICE
AmbientCapabilities=CAP_NET_ADMIN CAP_NET_BIND_SERVICE
NoNewPrivileges=true
ExecStart=/usr/bin/trojan-go -config /etc/trojan-go/config.json
Restart=on-failure
RestartSec=10s
LimitNOFILE=infinity

[Install]
WantedBy=multi-user.target
EOF

```

ä¸Šé¢çš„trojan-goå’Œnginxå‡ä¸ºå¯ä»¥ä¿è¯è‰¯å¥½å·¥ä½œçš„åŸºç¡€é…ç½®ï¼Œtrojan-goé…ç½®ä¸­ä¸€äº›é€‰é¡¹éœ€æ ¹æ®ä¸ªäººæƒ…å†µç¨ä½œè°ƒæ•´ï¼š

- "password"ï¼šå»ºç«‹trojna-goè¿æ¥çš„è‡ªå®šä¹‰å¯†ç ï¼Œé…ç½®å®¢æˆ·ç«¯éœ€è¦å¡«å…¥ç›¸åŒçš„å¯†ç 
- "ssl"->"cert": ä¸Šä¼ åˆ°VPSçš„è¯ä¹¦æ–‡ä»¶è·¯å¾„
- "ssl"->"key": ä¸Šä¼ åˆ°VPSçš„è¯ä¹¦ç§é’¥è·¯å¾„
- "ssl"->"fall_back": é‡åˆ°éTLSè¿æ¥æ—¶å›è½ç«¯å£ï¼Œç”±nginxå¤„ç†è¿”å›400å³å¯
- "ssl"->"sni": TLSè¿æ¥ç”¨äºæ£€æŸ¥httpè¯·æ±‚urlæ˜¯å¦æ­£ç¡®çš„æœºåˆ¶ï¼Œå’ŒåŸŸåä¿æŒä¸€è‡´
- "websocket"->"enable"ï¼šé€šè¿‡CDNä»£ç†çš„trojan-goè¿æ¥å¿…é¡»æ‰“å¼€websocket
- "websocket"->"path"ï¼šwebsocketè¯·æ±‚è·¯å¾„ï¼Œå¡«ä¸€ä¸ªæ¯”è¾ƒå¤æ‚çš„å­—ç¬¦ä¸²ï¼Œå®¢æˆ·ç«¯ä¸­éœ€è¦ä¿æŒä¸€è‡´
- "websocket"->"host"ï¼šä½¿ç”¨äº†CDNï¼Œå¿…é¡»å¡«å…¥åŸŸå

4.ä½¿èƒ½å’Œé‡å¯æœåŠ¡ï¼Œç¡®è®¤trojan-goå’Œnginxå‡æ­£å¸¸å¯åŠ¨

```bash
$ systemctl restart nginx
$ systemctl status nginx
â— nginx.service - A high performance web server and a reverse proxy server
     Loaded: loaded (/lib/systemd/system/nginx.service; enabled; vendor preset: enabled)
     Active: active (running) since Tue 2022-11-01 05:47:59 UTC; 23min ago
       Docs: man:nginx(8)
   Main PID: 10678 (nginx)
      Tasks: 2 (limit: 2339)
     Memory: 1.6M
        CPU: 6ms
     CGroup: /system.slice/nginx.service
             â”œâ”€10678 nginx: master process /usr/sbin/nginx -g daemon on; master_process on;
             â””â”€10679 nginx: worker process

Nov 01 05:47:59 vultr systemd[1]: nginx.service: Succeeded.
Nov 01 05:47:59 vultr systemd[1]: Stopped A high performance web server and a reverse proxy server.
Nov 01 05:47:59 vultr systemd[1]: Starting A high performance web server and a reverse proxy server...
Nov 01 05:47:59 vultr systemd[1]: nginx.service: Failed to parse PID from file /run/nginx.pid: Invalid argument
Nov 01 05:47:59 vultr systemd[1]: Started A high performance web server and a reverse proxy server.

$ systemctl enable trojan-go
Created symlink /etc/systemd/system/multi-user.target.wants/trojan-go.service â†’ /lib/systemd/system/trojan-go.service.
$ systemctl start trojan-go
$ systemctl status trojan-go
â— trojan-go.service - Trojan-Go - An unidentifiable mechanism that helps you bypass GFW
     Loaded: loaded (/lib/systemd/system/trojan-go.service; enabled; vendor preset: enabled)
     Active: active (running) since Tue 2022-11-01 06:10:32 UTC; 8s ago
       Docs: https://p4gefau1t.github.io/trojan-go/
   Main PID: 11065 (trojan-go)
      Tasks: 4 (limit: 2339)
     Memory: 2.7M
        CPU: 6ms
     CGroup: /system.slice/trojan-go.service
             â””â”€11065 /usr/bin/trojan-go -config /etc/trojan-go/config.json

Nov 01 06:10:32 vultr trojan-go[11065]: [DEBUG] 2022/11/01 06:10:32 github.com/p4gefau1t/trojan-go/tunnel/trojan.NewServer:server.go:2>
Nov 01 06:10:32 vultr trojan-go[11065]: [DEBUG] 2022/11/01 06:10:32 github.com/p4gefau1t/trojan-go/tunnel/mux.NewServer:server.go:92 m>
Nov 01 06:10:32 vultr trojan-go[11065]: [DEBUG] 2022/11/01 06:10:32 github.com/p4gefau1t/trojan-go/tunnel/simplesocks.NewServer:server>
Nov 01 06:10:32 vultr trojan-go[11065]: [DEBUG] 2022/11/01 06:10:32 github.com/p4gefau1t/trojan-go/tunnel/websocket.NewServer:server.g>
Nov 01 06:10:32 vultr trojan-go[11065]: [DEBUG] 2022/11/01 06:10:32 github.com/p4gefau1t/trojan-go/tunnel/trojan.NewServer:server.go:2>
Nov 01 06:10:32 vultr trojan-go[11065]: [DEBUG] 2022/11/01 06:10:32 github.com/p4gefau1t/trojan-go/statistic/memory.NewAuthenticator:m>
Nov 01 06:10:32 vultr trojan-go[11065]: [DEBUG] 2022/11/01 06:10:32 github.com/p4gefau1t/trojan-go/tunnel/trojan.NewServer:server.go:2>
Nov 01 06:10:32 vultr trojan-go[11065]: [DEBUG] 2022/11/01 06:10:32 github.com/p4gefau1t/trojan-go/tunnel/mux.NewServer:server.go:92 m>
Nov 01 06:10:32 vultr trojan-go[11065]: [DEBUG] 2022/11/01 06:10:32 github.com/p4gefau1t/trojan-go/tunnel/simplesocks.NewServer:server>
Nov 01 06:10:32 vultr trojan-go[11065]: [DEBUG] 2022/11/01 06:10:32 github.com/p4gefau1t/trojan-go/tunnel/tls.(*Server).AcceptConn:ser>
```

ç„¶åå›åˆ°Cloudflareæ·»åŠ åŸŸåè§£æ

1. å›åˆ°Cloudflareç½‘é¡µä¸Šï¼Œåœ¨"SSL/TLS"->"Overview"ä¸­é€‰æ‹©åŠ å¯†æ¨¡å¼ï¼ŒæŒ‰å›¾ä¸­é€‰æ‹©"Full(strict)"

   ![202211011734882](/images/202211011734882.png)

2. æ¥ç€åœ¨DNSè®¾ç½®ä¸­æ–°å¢ä¸€æ¡Aè®°å½•ï¼Œå¯¹åº”trojan-goä¸­é…ç½®çš„URLè·¯å¾„ï¼Œä¿æŒCDNä»£ç†æ‰“å¼€çŠ¶æ€ï¼Œç‚¹å‡»"Save"

   ![202211011745839](/images/202211011745839.png)

3. æ¥ç€å°è¯•åœ¨æµè§ˆå™¨ä¸­è¾“å…¥URLæ‰“å¼€ï¼Œå¯ä»¥çœ‹åˆ°nginxçš„é»˜è®¤ä¸»é¡µ

   ![202211011748000](/images/202211011748000.png)

è¿™æ ·æœåŠ¡ç«¯çš„é…ç½®å°±ç®—å®Œæˆäº†ï¼Œå› ä¸ºæ¯ä¸€æ­¥éƒ½æ˜¯å‚ç…§ç½‘ä¸Šå®¹æ˜“æ‰¾åˆ°çš„å®ç°æ¥è¿›è¡Œçš„ï¼Œå…¶ä¸­ä¹Ÿæœ‰ä¸å°‘å¯ä»¥ä¼˜åŒ–çš„åœ°æ–¹å’Œè¿›é˜¶é…ç½®ï¼Œæ¯”å¦‚ä½¿ç”¨cloudflareæˆ–è€…trojanä¹Ÿå¯ä»¥ç›´æ¥ç”³è¯·httpsè¯ä¹¦ï¼ŒVPSå†…æ ¸åˆ‡æ¢æ‹¥å¡æ§åˆ¶ä¸ºbbrç®—æ³•ï¼ŒCloudflareé«˜çº§é…ç½®ï¼Œå®¹å™¨éƒ¨ç½²ï¼Œè¿™äº›å‘ç•™åˆ°åæœŸæ¥å¡«ã€‚

### å®¢æˆ·ç«¯è½¯ä»¶çš„é…ç½®

å®¢æˆ·ç«¯è¿æ¥åˆ°æœºåœºçš„æœºåˆ¶æ˜¯åœ¨æœ¬æœºåˆ›å»ºä¸€ä¸ªHTTPæˆ–SOCKSçš„ä»£ç†ç«¯å£ï¼ŒåŒæ—¶æ›´æ”¹ç³»ç»Ÿçš„ä»£ç†è®¾ç½®ï¼Œç„¶åå„ç§æ¡Œé¢ç”¨æˆ·è½¯ä»¶åœ¨å‘é€ç½‘ç»œè¯·æ±‚æ—¶é¦–å…ˆä¼šè¯¢é—®ç³»ç»Ÿæ˜¯å¦è®¾ç½®äº†ä»£ç†ï¼Œå¦‚æœæ˜¯å°±å°†åŸå…ˆçš„TCP/UDPæ•°æ®ç»è¿‡HTTP/SOCKSå†æ¬¡åŒ…è£¹å‘é€åˆ°ä»£ç†ç«¯å£ï¼Œå®¢æˆ·ç«¯è§£å‡ºåŸå…ˆçš„TCP/UDPæ•°æ®å†æ ¹æ®æ‰€ä½¿ç”¨çš„æœºåœºåè®®å†æ¬¡åŒ…è£¹å‘å¾€æœºåœºï¼ˆæˆ–è€…CDNç­‰å…¶ä»–ä»£ç†ï¼‰ã€‚è¿™é‡Œå°±è¦æ±‚å®¢æˆ·ç«¯èƒ½åŒºåˆ†è¯·æ±‚çš„ç½‘å€æˆ–IPä¸­ï¼Œå“ªäº›æœåŠ¡å™¨ä½äºä¸­å›½å¤§é™†çš„ç½‘å€å’ŒIPï¼Œå“ªäº›æ˜¯å±€åŸŸç½‘IPï¼Œç„¶åå°†è¿™äº›åœ°å€çš„è¯·æ±‚è½¬å›ç›´è¿ã€‚å½“å‰ä¸»æµç¿»å¢™è½¯ä»¶æ˜¯é…ç½®æœ¬åœ°çš„ç½‘å€å’ŒIPè·¯ç”±è§„åˆ™æ–‡ä»¶å®ç°çš„ï¼Œgithubå­˜åœ¨è®¸å¤šå®šæœŸæ›´æ–°çš„ä»“åº“è·¯ç”±è§„åˆ™æ–‡ä»¶çš„ä»“åº“ï¼Œè¿™é‡Œä»[v2ray-rules-dat](https://github.com/Loyalsoldier/v2ray-rules-dat)ä¸‹è½½çš„IPè·¯ç”±è§„åˆ™æ–‡ä»¶geopip.datå’Œç½‘å€è§„åˆ™æ–‡ä»¶geosite.datã€‚ä»¥ä¸‹ä»‹ç»ä¸åŒç³»ç»Ÿä¸­æ–­ä¸Šè½¯ä»¶çš„é…ç½®

####	Windows,Linuxå’ŒMacOS
trojan-goçš„è½¯ä»¶ç»„æˆéå¸¸ç®€å•ï¼Œåªæœ‰ä¸€ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œæ ¹æ®é…ç½®æ–‡ä»¶æ—¢å¯ä»¥å·¥ä½œåœ¨æœåŠ¡å™¨æ¨¡å¼ä¹Ÿå¯ä»¥å·¥ä½œåœ¨å®¢æˆ·ç«¯æ¨¡å¼ï¼Œæ‰€ä»¥åœ¨Windowsæˆ–è€…Linuxä¸Šåªè¦ä»¥æ­£ç¡®çš„å‚æ•°æ‰§è¡Œtranjon-goæ–‡ä»¶ï¼Œå¹¶åœ¨ç³»ç»Ÿä»£ç†ä¸­æ·»åŠ ä»£ç†å°±èƒ½å·¥ä½œï¼Œä½¿ç”¨æ¡Œé¢å®¢æˆ·ç«¯[qv2ray](https://github.com/Qv2ray/Qv2ray)ï¼ˆå·²åœæ­¢ç»´æŠ¤ï¼‰åªæ˜¯èŠ‚çœæ·»åŠ å¯åŠ¨è„šæœ¬çš„å·¥ä½œã€‚ä»¥ä¸‹æ˜¯qv2rayçš„é…ç½®æ­¥éª¤

1. ä»githubä¸‹è½½è½¯ä»¶æœ€æ–°çš„Qv2ray v2.7.0[è½¯ä»¶](https://github.com/Qv2ray/Qv2ray/releases/tag/v2.7.0)ï¼Œåªæœ‰æœ€åè¿™ä¸ªç‰ˆæœ¬æ‰æ”¯æŒtrojan-goæ’ä»¶ã€‚åŒæ—¶ä¸‹è½½ä¸€ä¸ªè€ç‰ˆæœ¬çš„[v2ray](https://github.com/v2fly/v2ray-core/releases/tag/v4.45.0)ï¼ˆå› ä¸ºqv2rayåŸæœ¬æ˜¯ä¸ºv2rayå¼€å‘çš„ï¼Œä¼šé¦–å…ˆæ£€æŸ¥v2rayæ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œæœ€æ–°ç‰ˆçš„v2rayçš„æ¥å£æœ‰å˜åŠ¨ï¼‰ï¼Œtrojan-goï¼ŒQv2rayçš„[trojan-goæ’ä»¶](https://github.com/Qv2ray/QvPlugin-Trojan-Go/releases/tag/v3.0.0)ï¼Œä»¥åŠè·¯ç”±è§„åˆ™æ–‡ä»¶

2. å®‰è£…å¥½Qv2rayåï¼Œé€‰æ‹©"Perference"->"Kernel Setting"é…ç½®v2rayæ ¸å¿ƒå¯æ‰§è¡Œæ–‡ä»¶å®Œæ•´è·¯å¾„å’Œè·¯ç”±è§„åˆ™æ–‡ä»¶æ‰€åœ¨ç›®å½•

![202211021715380](/images/202211021715380.png)

3. å°†ä¸‹è½½çš„trojan-goæ’ä»¶å¤åˆ¶åˆ°æ’ä»¶ç›®å½•ï¼Œä¸åŒç³»ç»Ÿç”±"Plugins"->"Open Local Plugin Fold"ç¡®è®¤ï¼Œé‡æ–°æ‰“å¼€Qv2ray

![202211021717366](/images/202211021717366.png)

4. åœ¨Qv2rayä¸»ç•Œé¢ä¸­ç‚¹å‡»"Plugins"æ‰“å¼€æ’ä»¶ç®¡ç†ç•Œé¢ï¼Œå¯ä»¥çœ‹åˆ°å·²åŠ è½½çš„trojan-goæ’ä»¶ã€‚åœ¨trojan-goæ’ä»¶è®¾ç½®ä¸­æ·»åŠ trojan-goå¯æ‰§è¡Œæ–‡ä»¶çš„å®Œæ•´è·¯å¾„

![202211021723610](/images/202211021723610.png)

5. å‰©ä¸‹çš„é…ç½®å°±éƒ½å¯ä»¥é€šè¿‡å¦‚ä¸‹çš„jsoné…ç½®æ–‡ä»¶å¯¼å…¥ï¼Œç‚¹å‡»Qv2rayå·¦ä¸‹è§’çš„"Import"ï¼Œé€‰æ‹©"Advanced"->"Open JSON Editor"å¡«å…¥å¦‚ä¸‹å†…å®¹ï¼Œç‚¹å‡»"OK"å¯¼å…¥å°±å®Œæˆäº†ä¸€ä¸ªä»£ç†å‡ºå£é…ç½®çš„åˆ›å»ºï¼Œæ³¨æ„ä¿æŒå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¸­ç›¸åº”é…ç½®çš„ä¸€è‡´

   ![202211021933411](/images/202211021933411.png)
```json
{
  "outbounds": [
      {
          "_QV2RAY_USE_GLOBAL_FORWARD_PROXY_": false,
          "mux": {
              "concurrency": 1,
              "enabled": null
          },
          "protocol": "trojan-go",
          "sendThrough": "0.0.0.0",
          "settings": {
              "encryption": "",
              "host": "api.dot4.xyz",
              "mux": false,
              "password": "s9cbH8&2m%xN",
              "path": "/passthrough",
              "plugin": "",
              "port": 443,
              "server": "api.dot4.xyz",
              "sni": "api.dot4.xyz",
              "type": 1
          },
          "streamSettings": {
          },
          "tag": "PROXY"
      }
  ]
}

```

6. Qv2rayé»˜è®¤åœ¨æœ¬åœ°æ‰“å¼€`http://127.0.0.1:1089`å’Œ`socks5://127.0.0.1:8889`ä¸¤ä¸ªä»£ç†ç›‘å¬ç«¯å£ï¼Œè®¾ç½®ä»£ç†è¿æ¥åLinux/MacOSå¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤æµ‹è¯•ä»£ç†çš„è¿é€šæ€§ï¼Œè¿”å›301è¡¨ç¤ºå¯ä»¥æ­£å¸¸è®¿é—®googleäº†ã€‚
   ```bash
   $ curl --proxy socks5://localhost:1089 google.com
   <HTML><HEAD><meta http-equiv="content-type" content="text/html;charset=utf-8">
   <TITLE>301 Moved</TITLE></HEAD><BODY>
   <H1>301 Moved</H1>
   The document has moved
   <A HREF="http://www.google.com/">here</A>.
   </BODY></HTML>
   ```

   Windowsåˆ™å¯ä»¥åˆ©ç”¨powershellæä¾›çš„iwrå‘½ä»¤æ£€æŸ¥ï¼ˆiwrä¸æ”¯æŒsocks5ï¼‰ï¼Œå¦‚ä¸‹è¡¨ç¤ºæ­£å¸¸

   ```powershell
   > Invoke-WebRequest -Proxy http://127.0.0.1:8889 google.com
   
   
   StatusCode        : 200
   StatusDescription : OK
   Content           : <!doctype html><html itemscope="" itemtype="http://schema.org/WebPage" lang="en"><head><meta conten
                       t="Search the world's information, including webpages, images, videos and more. Google has many spe
                       ci...
   RawContent        : HTTP/1.1 200 OK
   ```

   ç»éªŒè¯Windowsçš„æµè§ˆå™¨æ­¤æ—¶å¯ä»¥æ­£å¸¸é€šè¿‡ä»£ç†è®¿é—®Googleäº†ï¼Œä½†æ˜¯Linuxä¸Šä½¿ç”¨Edgeæ²¡æœ‰èµ°ä»£ç†ä½†æ˜¯Firefoxåˆ™æ˜¯èµ°çš„ä»£ç†ï¼Œå¯èƒ½ä¸¤ä¸ªåº”ç”¨ä½¿ç”¨çš„ç½‘ç»œAPIä¸ä¸€æ ·ã€‚

####	Android

trojan-goæ˜¯ä¸€ç§æœ€è¿‘æ‰æµè¡Œèµ·æ¥çš„ä»£ç†åè®®ï¼Œæ‰€ä»¥ç›¸å¯¹è€Œè¨€æ”¯æŒçš„åº”ç”¨æ¯”è¾ƒå°‘ï¼Œ[SagerNet](https://github.com/SagerNet/SagerNet)æä¾›äº†å¯¹trojan-goçš„å®Œæ•´æ”¯æŒï¼Œå¯ä»¥ä»F-Droidåº”ç”¨å•†åº—ä¸‹è½½ã€‚ä½¿ç”¨SagerNetæ‰‹åŠ¨ä¸‹è½½å’ŒæŒ‡å®šæœºåœºåè®®æ ¸å¿ƒæ–‡ä»¶å’Œè·¯ç”±è§„åˆ™æ–‡ä»¶ï¼Œè€Œä¼šåœ¨ç¬¬ä¸€æ¬¡å¯åŠ¨ä»£ç†æ—¶è‡ªåŠ¨ä¸‹è½½è¿™äº›æ–‡ä»¶å¹¶ä¸”è‡ªåŠ¨æ›´æ–°ï¼Œæ‰€ä»¥åªè¦äºŒç»´ç å¯¼å…¥PCå®¢æˆ·ç«¯å·²æœ‰çš„ä»£ç†é…ç½®å³å¯å»ºç«‹è¿æ¥ï¼ˆåœ¨Qv2rayä¸­é€‰æ‹©ä¸€ä¸ªä»£ç†é…ç½®ç‚¹å‡»"Configuration Details"å³ä¸‹ä¾§é˜´å½±å³å¯å±•ç¤ºåˆ†äº«äºŒç»´ç ï¼‰ã€‚

####	IOS

IOSç›®å‰ä½¿ç”¨è¾ƒå¤šçš„ä»£ç†è½¯ä»¶æ˜¯shadowrocketï¼Œæ”¯æŒtrojan-goï¼Œå†…ç½®ç®€å•çš„è·¯ç”±è§„åˆ™å¯¹äºæ‰‹æœºåº”ç”¨ä¹Ÿå®Œå…¨å¤Ÿç”¨ã€‚ä¸è¿‡å¾—è‡ªè¡Œæ³¨å†Œä¸€ä¸ªç¾åŒºapple IDç™»å½•apple storeä¸‹è½½ï¼Œæ”¶è´¹2.99åˆ€ï¼Œåœ¨å›½å†…ç”µå•†å¹³å°å……å€¼3ç¾é‡‘çš„ç¤¼å“å¡å³å¯ã€‚websocketçš„åŒæ ·æ”¯æŒäºŒç»´ç æ‰«æå¯¼å…¥ï¼Œè¿™é‡Œä¸è¿‡å¤šèµ˜å™ã€‚

### è½¯è·¯ç”±é€æ˜ä»£ç†çš„é…ç½®

æ–°ç‰ˆæœ¬çš„é¸¿è’™ç³»ç»Ÿä¿®æ”¹äº†å†…æ ¸ä½¿å¾—æ‰€æœ‰çš„ä»£ç†è½¯ä»¶éƒ½å¤±æ•ˆäº†ï¼Œæˆ‘æ‰‹ä¸Šæœ‰ä¸€å°åä¸ºæ‰‹æœºå’Œå¹³æ¿éƒ½æ²¡æ³•ç¿»å¢™äº†ï¼Œè€Œä¸”Androidåå°ä¸€ç›´æŒ‚ç€ç¿»å¢™è½¯ä»¶è€—ç”µå¢åŠ ä¹Ÿæ¯”è¾ƒæ˜æ˜¾ã€‚æŠ±ç€å­¦ä¹ çš„æ€åº¦ï¼Œæˆ‘å…¥æ‰‹äº†ä¸€ä¸ªè½¯è·¯ç”±ä»¥å®ç°å±€åŸŸç½‘çš„å…¨å±€ä»£ç†ï¼ŒåŸæœ¬æ‰“ç®—ä½¿ç”¨ç°æˆçš„OpenWRTçš„å›ºä»¶å¼€ä»£ç†ï¼Œä½†æ˜¯OpenWRTæ²¡æœ‰é©±åŠ¨æ”¯æŒæˆ‘æ‰€ä½¿ç”¨çš„æœ€æ–°çš„AX210ç½‘å¡ã€‚æ‰€ä»¥ä¸‹é¢çš„æ“ä½œå‡åŸºäºå‡çº§äº†5.19å†…æ ¸çš„Debian 11ï¼Œå°†ä¸€ä¸ªç½‘å£ä½œä¸ºWANï¼Œ3ä¸ªç½‘å£å’Œä¸€ä¸ªæ— çº¿APä½œä¸ºLANå£ä»¥å®ç°é€æ˜ä»£ç†ã€‚

1. é¦–å…ˆä¸‹è½½trajon-goï¼Œgeoip.datå’Œgeosite.datæ”¾åˆ°åˆé€‚çš„ç›®å½•ï¼Œæ·»åŠ å¦‚ä¸‹å®¢æˆ·ç«¯é…ç½®æ–‡ä»¶

   ```bash
   $ echo <<-'EOF' > /etc/trojan-go/config.json
   > {
       "run_type": "client",	//é€æ˜ä»£ç†æ”¹ä¸ºnat
       "local_addr": "127.0.0.1",
       "local_port": 1080,
       "remote_addr": "api.dot4.xyz",
       "remote_port": 443,
       "password": [
           "s9cbH8&2m%xN"
       ],
       "ssl": {
           "sni": "api.dot4.xyz"
       },
       "websocket": {
           "enabled": true,
           "path": "/passthrough",
           "host": "api.dot4.xyz"
       },
       "mux": {
           "enabled": true,
           "concurrency": 8,
           "idle_timeout": 60
       },
       "router": {	//é€æ˜ä»£ç†ä¸æ”¯æŒrouteréœ€åˆ é™¤
           "enabled": true,
           "bypass": [
               "geoip:cn",
               "geoip:private",
               "geosite:cn",
               "geosite:private"
           ],
           "block": [
               "geosite:category-ads"
           ],
           "proxy": [
               "geosite:geolocation-!cn"
           ],
           "default_policy": "proxy",
           "geoip": "/usr/share/trojan-go/geoip.dat",
           "geosite": "/usr/share/trojan-go/geosite.dat"
       }
   }
   EOF
   ```

   

2. æ·»åŠ å’ŒæœåŠ¡ç«¯ç›¸åŒçš„å¼€æœºè‡ªå¯é…ç½®æ–‡ä»¶ï¼Œå¯åŠ¨trojan-goæœåŠ¡æµ‹è¯•é…ç½®çš„èƒ½å¤Ÿæ­£å¸¸å·¥ä½œåï¼Œä¿®æ”¹JSONé…ç½®ä¸­çš„"run_type"ä¸º"nat"åˆ‡æ¢ä¸ºé€æ˜ä»£ç†æ¨¡æ¨¡å¼ã€‚é‡å¯trojan-goæœåŠ¡æŠ¥é”™ï¼š`hub.com/p4gefau1t/trojan-go/proxy.(*Option).Handle:option.go:78 router is not allowed in nat mode`ï¼Œå› ä¸ºtrojanä½¿ç”¨çš„tproxyå®ç°çš„å…¨å±€ä»£ç†æ¨¡å¼ï¼Œtproxyæ— æ³•å†…éƒ¨åˆ†æµã€‚trojan-goä¹Ÿæ²¡æœ‰å†…å»ºDNSåŠŸèƒ½ï¼Œæ‰€ä»¥éœ€è¦é¢å¤–æ­å»ºDNSæœåŠ¡å™¨ä»¥å®ç°åˆ†æµã€‚ä½†æ˜¯åœ¨æ­¤ä¹‹å‰æˆ‘ä»¬é¦–å…ˆè¦å¯¹ç½‘å£åšç›¸å…³é…ç½®ï¼Œæ¨¡æ‹Ÿå®ç°ä¸€ä¸ªæ™®é€šè·¯ç”±å™¨çš„åŠŸèƒ½

   ```bash
   $ apt install -y netplan.io
   
   # netplané…ç½®
   # WANå£æ ¹æ®ä¸Šçº§ç½‘å…³é…ç½®ï¼Œè¿™é‡Œæ˜¯192.168.1.1/24
   $ cat <<-'EOF' >/etc/netplan/01-ethernet.yaml
   > network:
     version: 2
     renderer: NetworkManager
     ethernets:
       net0:
         dhcp4: yes
         dhcp4-overrides:
           use-dns: no
         addresses: [192.168.1.122/24]
         gateway4: 192.168.1.1
         nameservers:
           search: [lan]
           addresses: [127.0.0.1, 223.5.5.5, 233.6.6.6, 192.168.1.1]
       net1:
         dhcp4: no
         dhcp6: no
       net2:
         dhcp4: no
         dhcp6: no
       net3:
         dhcp4: no
         dhcp6: no
     wifis:
       wifi0:
         dhcp4: no
         dhcp6: no
         access-points:
           "dokodemodoor":
             mode: ap
             password: "123skr~~"
     bridges:
       lan:
         dhcp4: no
         dhcp6: no
         addresses: [10.60.122.254/24]
         interfaces: [net1, net2, net3, wifi0]
   EOF
   
   $ netplan generate	# ç”Ÿæˆä¸´æ—¶çš„åç«¯é…ç½®
   $ netplan try	# å°è¯•åº”ç”¨é…ç½®
   $ netplan apply	# åº”ç”¨é…ç½®
   $ systemctl enables netplan # ä½¿èƒ½æœåŠ¡ï¼Œä¸‹æ¬¡å¯åŠ¨å°±ä¼šè‡ªåŠ¨åº”ç”¨/etc/netplanä¸­çš„é…ç½®
   ```

   ä¸Šé¢çš„é…ç½®ä¸­ä¸»è¦å®ç°äº†ä»¥ä¸‹åŠŸèƒ½ï¼š

   - net0~net3å¯¹åº”è½¯è·¯ç”±ç‰©ç†å£çš„[å›ºå®šç½‘å£åç§°](https://wiki.archlinux.org/title/Network_configuration#Change_interface_name)ã€‚å…¶ä¸­net0ä½œä¸ºWANå£ï¼Œè®¾ç½®äº†ä¸€ä¸ªå›ºå®šIPï¼ŒåŒæ—¶ä¹Ÿæ¥å—ä¸Šçº§è·¯ç”±dhcpåˆ†é…çš„IP

   - net1ï¼Œnet2ï¼Œnet3é€šè¿‡è™šæ‹Ÿç½‘æ¡¥è¿æ¥ä½œä¸ºLANå£ï¼ŒWIFIç½‘å¡é…ç½®å·¥ä½œåœ¨APæ¨¡å¼ï¼Œçº³å…¥LANå£

   - è®¾ç½®`dhcp4-overrides`->`use-dns`ä¸ºnoï¼Œå³ä¸ä»dhcpè·å–advertised DNSæœåŠ¡å™¨åœ°å€ï¼Œä½¿è½¯è·¯ç”±çš„DNSæŸ¥æ‰¾é¡ºåºä¸ºï¼šæœ¬æœºç«¯å£ï¼Œé˜¿é‡ŒDNSï¼Œä¸Šçº§è·¯ç”±å™¨ï¼Œè¿™æ ·DNSæŸ¥è¯¢é¦–å…ˆä¼šç”±dnsmasqå¤„ç†ã€‚ä½†æ˜¯éå¸¸é—æ†¾çš„æ˜¯ç›®å‰netplanä¸­æ­¤é¡¹å¯¹äºNetworkManagerä½œä¸ºrendereræ—¶ä¸ç”Ÿæ•ˆï¼Œæ‰€ä»¥åªèƒ½åœ¨NetworkManageré…ç½®ä¸­æŒ‡å®šdnsmasä¸ºä»£ç†nameserveræˆ–è€…æ‰‹åŠ¨ä¿®æ”¹/etc/resolv.confå¹¶åŠ é”é˜²æ­¢NetworkManageræ›´æ–°ï¼š

     ```bash
     # ä¿®æ”¹NetworkManageré…ç½®
     $ sed -i "/\[main\]/a dns=dnsmasq" /etc/NetworkManager/NetworkManager.conf
     
     # ä½¿nameserver 127.0.0.1å¤„äºç¬¬ä¸€çš„é¡ºåºå¹¶åŠ é”
     $ chattr +i /etc/resolv.conf
     ```

   è¿™é‡Œä½¿ç”¨netplanåªæ˜¯å®Œæˆé“¾è·¯å±‚çš„éƒ¨åˆ†é…ç½®ï¼Œæ¨¡æ‹Ÿä¸€ä¸ªè·¯ç”±å™¨è¿˜è¦æ·»åŠ WANå£å’ŒLANå£ä¹‹é—´çš„NATï¼Œä»¥åŠé…ç½®ç»‘å®šåˆ°LANå£çš„dhcpæœåŠ¡å™¨ï¼Œåœ¨ä¸‹é¢çš„é…ç½®ä¸­å€ŸåŠ©iptableså’Œdnsmasqæ¥å®ç°

   

3. DNSåˆ†æµä¾é dnsmasqï¼Œdnscrypt-proxyæœåŠ¡ï¼Œdnsmaqè¿æ¥åˆ°å›½å†…çš„DNSæœåŠ¡å™¨è´Ÿè´£æ­£å¸¸çš„ç½‘ç«™çš„DNSæŸ¥è¯¢ï¼Œdnscrypt-proxyåˆ™ä½¿ç”¨åŠ å¯†åè®®è¿æ¥åˆ°å›½å¤–çš„DNSæœåŠ¡å™¨æŸ¥è¯¢è¢«å¢™å¼‚å¸¸ç½‘ç«™çš„IPã€‚æ‰€ä»¥è¿˜æ˜¯è¦æœ‰ä¸€ä¸ªåŠæ³•åŒºåˆ†å›½å†…å’Œå›½å¤–åŸŸåï¼Œè¿™é‡Œé€šè¿‡ipsetä¿å­˜gfwlistæä¾›çš„è¢«å¢™åŸŸåç›®å½•ï¼Œç„¶åä½¿ç”¨iptablesåŒ¹é…å¼‚å¸¸IPè½¬å‘ç»™é€æ˜ä»£ç†ç«¯å£ï¼Œå›½å†…åˆ™ç›´è¿ã€‚é¦–å…ˆæ­å»ºå¥½DNSæœåŠ¡ï¼Œé¡ºä¾¿ä½¿ç”¨dnsmasqæ­å»ºLANçš„dhcpdæœåŠ¡

   ```bash
   # å®‰è£…dnsmasqå’Œdnscrypt-proxyï¼Œä»¥åŠdnså‘½ä»¤è¡Œå·¥å…·
   $ apt install -y dnsmasq dnscrypt-proxy bind9-dnsutils
   
   # ç¡®è®¤/etc/resolv.confä¸­æœ¬åœ°ä¼˜å…ˆçš„DNSæŸ¥æ‰¾é¡ºåº
   $ cat /etc/resolv.conf
   # Generated by NetworkManager
   search lan
   nameserver 127.0.0.1
   nameserver 223.5.5.5
   nameserver 223.6.6.6
   # NOTE: the libc resolver may not support more than 3 nameservers.
   # The nameservers listed below may not be recognized.
   nameserver 192.168.1.1
   
   # é…ç½®dnsmasq
   $ cat <<'EOF' > /etc/dnsmasq.conf
   > no-resolv
   listen-address=::1,127.0.0.1,10.60.122.254	# å¯¹æœ¬æœºå’ŒLANå£æä¾›DNSæœåŠ¡
   cache-size=1000
   interface=lan	# å°†dhcpdç»‘å®šåˆ°lanå£
   server=233.5.5.5	# å›½å†…ä½¿ç”¨é˜¿é‡ŒDNS
   server=233.6.6.6
   expand-hosts
   domain=dokodemodoor.lan
   address=/dokodemodoor.lan/10.60.122.254
   dhcp-range=10.60.122.1,10.60.122.100,255.255.255.0,24h	# dhcpdé…ç½®ï¼šåˆ†é…ipèŒƒå›´ï¼Œç§Ÿçº¦æ—¶é•¿
   EOF
   
   dnsmasq --test # ç¡®è®¤é…ç½®æ–‡ä»¶è¯­æ³•æ²¡æœ‰é—®é¢˜
   systemcty restart dnsmasq # é‡å¯dnsmasqæœåŠ¡
   
   # dnscrypt-proxy.serviceä½¿ç”¨é»˜è®¤çš„è®¾ç½®å³å¯
   # é¢å¤–é…ç½®dnscrypt-proxy.socketï¼Œç¡®è®¤é…ç½®æ–‡ä»¶æ–‡ä»¶ä¸­å­˜åœ¨listen_address=[]è¿™ä¸€è¡Œ
   $ cat <<'EOF' > /usr/lib/systemd/system/dnscrypt-proxy.socket
   > [Unit]
   Description=dnscrypt-proxy listening socket
   Documentation=https://github.com/DNSCrypt/dnscrypt-proxy/wiki
   Before=nss-lookup.target
   Wants=nss-lookup.target
   Wants=dnscrypt-proxy-resolvconf.service
   
   [Socket]
   ListenStream=127.0.2.1:1053	# ç›‘å¬ç«¯å£æ”¹ä¸ºå…¶ä»–æœªä½¿ç”¨çš„ç«¯å£ï¼Œé¿å…ä¸dnsmasqå†²çª
   ListenDatagram=127.0.2.1:1053
   ListenStream=[::1]:1053
   ListenDatagram=[::1]:1053
   NoDelay=true
   DeferAcceptSec=1
   
   [Install]
   WantedBy=sockets.target
   EOF
   
   systemctl daemon-reload
   systemctl restart dnscrypt-proxy.socket
   
   # æ­¤æ—¶æ‰§è¡ŒnslookupæŸ¥è¯¢åº”è¯¥æ˜¾ç¤ºèµ°çš„æœ¬åœ°53ç«¯å£
   $ nslookup baidu.com
   Server:         127.0.0.1
   Address:        127.0.0.1#53
   
   Non-authoritative answer:
   Name:   baidu.com
   Address: 39.156.66.10
   Name:   baidu.com
   Address: 110.242.68.66
   
   # ä½¿ç”¨å…¶ä»–è®¾å¤‡é€šè¿‡è¿æ¥LANå£å¯ä»¥è‡ªåŠ¨è·å–IPï¼Œsystemctl status dnsmasqä¹Ÿå¯ä»¥çœ‹åˆ°ç›¸å…³æ—¥å¿—
   
   # ç„¶åä»githubè·å–gfwlistç”¨äºåŒºåˆ†è¢«å¢™ç½‘ç«™ï¼Œè¿™é‡Œç›´æ¥ä½¿ç”¨å¯ä»¥githubå¯ä»¥æ‰¾åˆ°çš„gfwlistè½¬dnsmasqè§„åˆ™è„šæœ¬ï¼Œä¸‹è½½åæ‰§è¡Œè„šæœ¬ç”Ÿæˆdnsmasqå¯ä»¥è¯†åˆ«çš„è·¯ç”±è§„åˆ™ã€‚-p 1053è¡¨ç¤ºå°†è§„åˆ™çš„ç½‘å€è½¬å‘ç»™ç›‘å¬ç«¯å£1053çš„dnscrypt-proxyå¤„ç†ï¼Œ-s gfwlistè¡¨ç¤ºåŒæ—¶åŠ å…¥åä¸ºgfwlistçš„set
   $ git clone https://github.com/cokebar/gfwlist2dnsmasq.git && cd gfwlist2dnsmasq
   $ ./gfwlist2dnsmasq.sh -p 1053 -s gfwlist -o gfwlist.conf
   
   # å¤§æ¦‚æµè§ˆgfwlistæ–‡ä»¶ç¡®è®¤è·¯ç”±è§„åˆ™çš„æœ‰æ•ˆæ€§
   # å°†ç”Ÿæˆçš„confæ–‡ä»¶å¤åˆ¶åˆ°/etc/dnsmasq.dè·¯å¾„ä¸‹ï¼Œdnsmasqä¼šè‡ªåŠ¨è¯»å–å…¶ä¸­çš„è·¯ç”±è§„åˆ™
   # ç„¶åéœ€è¦æ‰‹åŠ¨åˆ›å»ºåä¸ºgfwlistçš„IP setï¼Œç”¨äºIPåˆ†æµ
   $ ipset create gfwlist iphash
   
   # æ­¤æ—¶DNSæŸ¥è¯¢ä»»æ„è¢«å¢™çš„ç½‘å€ï¼Œåº”è¯¥è¿”å›æ­£ç¡®çš„IPåœ°å€
   # dnscrypt-proxyçš„æ—¥å¿—ä¸­/var/log/dnscrypt-proxy/query.logå¯ä»¥çœ‹åˆ°ç›¸å…³æŸ¥è¯¢è®°å½•
   $ nslookup facebook.com
   Server:         127.0.0.1
   Address:        127.0.0.1#53
   
   Non-authoritative answer:
   Name:   facebook.com
   Address: 157.240.22.35
   Name:   facebook.com
   Address: 2a03:2880:f131:83:face:b00c:0:25de
   
   # IP setä¸­ä¹Ÿå¯ä»¥çœ‹åˆ°æ–°å¢çš„è¢«å¢™IPï¼Œè€Œå›½å†…æ­£å¸¸è®¿é—®çš„IPä¸ä¼šåŠ åˆ°setä¸­
   $ ipset -L gfwlist
   Name: gfwlist
   Type: hash:ip
   Revision: 5
   Header: family inet hashsize 1024 maxelem 65536 bucketsize 12 initval 0x9aa08d27
   Size in memory: 240
   References: 0
   Number of entries: 1
   Members:
   157.240.22.35
   ```

   

4. å®Œæˆä»¥ä¸Šé…ç½®ï¼ŒWANå’ŒLANè¿˜æ˜¯2ä¸ªå•ç«¯çš„ç½‘æ®µï¼ŒåŠ ä¸‹æ¥æ·»åŠ å¿…è¦çš„å†…æ ¸è·¯ç”±è½¬å‘é…ç½®ã€‚æ£€æµ‹æ‰€æœ‰çš„LANæµé‡çš„ç›®æ ‡IPï¼Œå¦‚æœæ˜¯æ­£å¸¸IPåˆ™èµ°ç›´è¿ï¼Œè¢«å¢™IPåˆ™è½¬å‘åˆ°ç»™æœ¬åœ°çš„é€æ˜ä»£ç†ç«¯å£

   ```bash
   # å®‰è£…ç›¸å…³è½¯ä»¶
   $ apt install -y ebtables iptables netfilter-persistent
   
   # ç¡®è®¤å¼€å¯äº†ç³»ç»Ÿçš„IPè½¬å‘é€‰é¡¹
   $ sed -i "s/#net.ipv4.ip_forward=1/net.ipv4.ip_forward=1/g" /etc/sysctl.conf
   $ sysctl -p
   
   # æ·»åŠ iptablesé…ç½®
   # æ‰€æœ‰net0å‡ºå£æµé‡åšSNATï¼Œè¿™æ ·è½¯è·¯ç”±å°±ç›¸å½“äºä¸€ä¸ªæ™®é€šçš„è·¯ç”±å™¨ï¼Œè¿æ¥åˆ°LANå£çš„è®¾å¤‡ä¹Ÿå°±èƒ½é€šè¿‡WANå£ä¸Šç½‘
   $ iptables -t nat -A POSTROUTING -o net0 -j MASQUERADE
   
   # æ–°å»ºTROJAN_GOè¡¨
   $ iptables -t mangle -N TROJAN_GO
   
   
   # ç›®æ ‡åœ°å€åŒ¹é…gfwlist setçš„åŒ…æ‰“ä¸Šæ ‡è®°ï¼Œè¿™é‡Œçš„1080å¯¹åº”trojan-goçš„æœ¬åœ°ä»£ç†ç«¯å£
   $ iptables -t mangle -A TROJAN_GO -j TPROXY -p tcp -m set --match-set gfwlist dst --on-ip=127.0.0.1 --on-port 1080 --tproxy-mark 0x01/0x01
   $ iptables -t mangle -A TROJAN_GO -j TPROXY -p udp -m set --match-set gfwlist dst --on-ip=127.0.0.1 --on-port 1080 --tproxy-mark 0x01/0x01
   
   # ä»LANå£è¿›å…¥çš„æ‰€æœ‰TCP/UDPåŒ…ï¼Œè·³è½¬TROJAN_GOé“¾
   $ iptables -t mangle -A PREROUTING -p tcp -i lan -j TROJAN_GO
   $ iptables -t mangle -A PREROUTING -p udp -i lan -j TROJAN_GO
   
   # æ·»åŠ è·¯ç”±ï¼Œæ‰“ä¸Šæ ‡è®°çš„åŒ…é‡æ–°è¿›å…¥æœ¬åœ°å›ç¯
   $ ip route add local default dev lo table 100
   $ ip rule add fwmark 1 lookup 100
   
   # å®Œæˆä»¥ä¸Šé…ç½®åï¼Œæ‰€æœ‰LANå£æ¥å…¥çš„è®¾å¤‡å°±åº”è¯¥å¯ä»¥ç§‘å­¦ä¸Šç½‘äº†ï¼Œä½†æ˜¯ip,ipsetå’Œiptablesæ·»åŠ çš„é…ç½®åœ¨æ¯æ¬¡é‡å¯åå°±ä¼šä¸¢å¤±ï¼Œè¿˜è¦ä¿å­˜ä½œä¸ºå¼€æœºè®¾å®š
   # å€ŸåŠ©netfilter-persistentæœåŠ¡è‡ªåŠ¨åœ¨å…³å¼€æœºæ—¶ä¿å­˜å’Œæ¢å¤è¿™äº›é…ç½®ï¼Œåªéœ€æŒ‡å®šç›®å½•æ·»åŠ è‡ªå®šä¹‰è„šæœ¬
   # é’ˆå¯¹ipsetæ·»åŠ è‡ªå®šä¹‰è„šæœ¬
   $ cat <<'EOF' >/usr/share/netfilter-persistent/plugins.d/10-ipset
   > #!/bin/sh
   
   set -e
   
   RULE_FILE=/etc/iptables/rules.ipset
   
   check_ipset()
   {
       if [ ! -e /sbin/ipset ]; then
           echo "Error: /sbin/ipset not found" >&2
           exit 1
       fi
       if [ ! -x /sbin/ipset ]; then
           echo "Error: /sbin/ipset is not executable file" >&2
           exit 1
       fi
   }
   
   
   load_rules()
   {
       #load ipset rules
       if [ ! -f "${RULE_FILE}" ]; then
           echo "Warning: skipping ipset (no rules to load)"
       else
           /sbin/ipset restore -file "${RULE_FILE}" > /dev/null || return 1
       fi
   }
   
   save_rules()
   {
       touch "${RULE_FILE}"
       chmod 0640 "${RULE_FILE}"
       /sbin/ipset save -file "${RULE_FILE}" > /dev/null || return 1
   }
   
   flush_rules()
   {
       /sbin/ipset destroy
   }
   
   check_ipset
   case "$1" in
   start|restart|reload|force-reload)
       flush_rules
       load_rules
       ;;
   save)
       save_rules
       ;;
   stop)
       # Why? because if stop is used, the firewall gets flushed for a variable
       # amount of time during package upgrades, leaving the machine vulnerable
       # It's also not always desirable to flush during purge
       echo "Automatic flushing disabled, use \"flush\" instead of \"stop\""
       ;;
   flush)
       flush_rules
       ;;
   *)
       echo "Usage: $0 {start|restart|reload|force-reload|save|flush}" >&2
       exit 1
       ;;
   esac
   EOF
   chmod +x /usr/share/netfilter-persistent/plugins.d/10-ipset
   
   # é’ˆå¯¹ip routeå’Œip ruleæ·»åŠ è‡ªå®šä¹‰è„šæœ¬
   cat <<'EOF' >/usr/share/netfilter-persistent/plugins.d/8-tproxy_iproute
   > #!/bin/sh
   
   set -e
   PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
   
   load_rules()
   {
   	ip route add local default dev lo table 100 || return 1
   	ip rule add fwmark 1 lookup 100
   }
   
   save_rules()
   {
       echo "Warning: skipping ip route (no need to save)"
   }
   
   flush_rules()
   {
       ip route flush table 100 || return 1
       ip rule del fwmark 1
   }
   
   case "$1" in
   start|restart|reload|force-reload)
       load_rules
       ;;
   save)
       save_rules
       ;;
   stop)
       # Why? because if stop is used, the firewall gets flushed for a variable
       # amount of time during package upgrades, leaving the machine vulnerable
       # It's also not always desirable to flush during purge
       echo "Automatic flushing disabled, use \"flush\" instead of \"stop\""
       ;;
   flush)
       flush_rules
       ;;
   *)
       echo "Usage: $0 {start|restart|reload|force-reload|save|flush}" >&2
       exit 1
       ;;
   esac
   EOF
   chmod +x /usr/share/netfilter-persistent/plugins.d/8-tproxy_iproute
   
   # æ‰‹åŠ¨ä¿å­˜ç¡®è®¤è„šæœ¬èƒ½æ­£å¸¸å·¥ä½œ
   $ netfilter-persistent save
   run-parts: executing /usr/share/netfilter-persistent/plugins.d/10-ipset save
   run-parts: executing /usr/share/netfilter-persistent/plugins.d/15-ip4tables save
   run-parts: executing /usr/share/netfilter-persistent/plugins.d/25-ip6tables save
   run-parts: executing /usr/share/netfilter-persistent/plugins.d/8-tproxy_iproute save
   Warning: skipping ip route (no need to save)
   
   # é‡å¯æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œå‰é¢ipï¼Œipsetå’Œiptablesè®¾ç½®çš„æ‰€æœ‰è§„åˆ™åº”è¯¥å¯ä»¥å®Œå…¨æ¢å¤
   $ ipset -L gfwlist
   $ iptables -t mangle -L
   $ iptables -t nat -L
   $ ip route l table 100
   $ ip rule l fwmark 1
   ```

5. åŒæ—¶ä¹ŸæŠŠgfwlisté…ç½®çš„æ›´æ–°æ·»åŠ ä¸ºå®šæ—¶æœåŠ¡ï¼š

   ```sh
   $ cat <<'EOF' >/usr/lib/systemd/system/update-dnsmasq-rule.service
   [Unit]
   Description=Update dnsmasq rule of gfwlist
   Wants=update-dnsmasq-rule.timer
   After=network.target network-online.target systemd-networkd.service NetworkManager.service
   
   [Service]
   Type=oneshot
   ExecStartPre=/bin/rm -f /etc/dnsmasq.d/.gfwlist.conf
   ExecStart=/usr/bin/gfwlist2dnsmasq.sh -p 1053 -s gfwlist -o /etc/dnsmasq.d/.gfwlist.conf
   ExecStartPost=/bin/mv -f /etc/dnsmasq.d/.gfwlist.conf /etc/dnsmasq.d/gfwlist.conf && /usr/bin/systemctl restart dnsmasq
   EOF
   
   $ cat <<'EOF' >/usr/lib/systemd/system/update-dnsmasq-rule.timer
   [Unit]
   Description=Weekly update dnsmasq rule of gfwlist
   Requires=dnsmasq.service
   
   [Timer]
   Unit=update-dnsmasq-rule.service
   OnCalendar=Weekly
   Persistent=true
   
   [Install]
   WantedBy=timer.target
   EOF
   
   $ systemctl enable update-dnsmasq-rule.service update-dnsmasq-rule.timer
   $ systemctl start update-dnsmasq-rule.timer
   ```

   

   å®Œæˆäº†ä»¥ä¸Šè®¾ç½®ï¼Œæ‰€æœ‰é€šè¿‡LANå£è¿æ¥åˆ°è½¯è·¯ç”±çš„è®¾å¤‡éƒ½èƒ½è‡ªåŠ¨è·å–ipå¹¶ä¸”ç§‘å­¦ä¸Šç½‘ã€‚å› ä¸ºAX210çš„é©±åŠ¨è¿˜æœ‰ç‚¹é—®é¢˜ï¼ŒWIFI APçš„æˆ‘æ²¡æ³•æµ‹è¯•ï¼Œæˆ‘æœ€åˆè¿½æ±‚WIFI 6Eå…¥æ‰‹çš„è¿™å¼ ç½‘å¡ä¸€ç›´æ²¡æœ‰åˆ©ç”¨èµ·æ¥ã€‚å…¶å®å¦‚æœæ”¹ä¸ºå•è‡‚è·¯ç”±çš„å½¢å¼è¯ï¼Œåˆ©ç”¨å·²æœ‰çš„æ— çº¿è·¯ç”±å™¨ï¼Œå°±ä¸éœ€è¦è½¯è·¯ç”±å…·æœ‰APçš„èƒ½åŠ›ï¼Œä¹Ÿå°±å¯ä»¥éšä¾¿é€‰ä¸€ä¸ªåªæœ‰ä¸€ä¸ªç½‘å£çš„å¼€å‘æ¿æˆ–è€…æ—§ç”µå­è®¾å¤‡ä»£æ›¿è½¯è·¯ç”±ï¼Œè¿™é‡Œå†æŒ–ä¸€ä¸ªå‘ã€‚å¦å¤–ç”±äºtrojan-goé€æ˜ä»£ç†å®ç°tproxyçš„é™åˆ¶ï¼Œåªå¼€ä¸€ä¸ªå·¥ä½œåœ¨é€æ˜ä»£ç†æ¨¡å¼ä¸‹çš„å®¢æˆ·ç«¯è½¯è·¯è‡ªèº«æ˜¯æ— æ³•ç§‘å­¦ä¸Šç½‘çš„

   **PSï¼š**è½¯è·¯ç”±åŒæ—¶å®‰è£…dockerä¼šå¯¼è‡´tproxyä»£ç†å¤±æ•ˆï¼Œæ‰§è¡Œ`sysctl -w net.bridge.bridge-nf-call-iptables=0`å›é€€dockerå¯¹å†…æ ¸å‚æ•°çš„ä¿®æ”¹å¯å›é¿æ­¤é—®é¢˜

   __PPSï¼š__å®é™…2ä¸ªæœˆä½“éªŒä¸‹è™½ç„¶éå¸¸ç¨³å®šï¼Œä½†æ˜¯æå°‘æ•°ç½‘ç«™è¿˜æ˜¯ä¼šå‡ºç°æ‰“ä¸å¼€æˆ–è€…åŠ è½½ä¸å®Œæ•´çš„æƒ…å†µï¼Œä½†æ˜¯ç”µè„‘æ‰“å¼€qv2rayä»£ç†é‡è¯•ï¼Œå°±èƒ½å¤Ÿæ­£å¸¸åŠ è½½ï¼Œå› ä¸ºqv2rayè®¾ç½®çš„ä»…å¯¹å¤§é™†ç½‘ç«™ç›´è¿ã€‚æœ¬ä»¥ä¸ºæ˜¯è¿™äº›ç½‘ç«™æœåŠ¡å™¨çš„IPè¢«å¢™äº†ï¼Œä½†æ˜¯å…³æ‰qv2rayçš„ä»£ç†åï¼Œåˆå¯ä»¥æ­£å¸¸åŠ è½½ã€‚å…·ä½“åŸå› æœ‰å¾…è¿›ä¸€æ­¥åˆ†æ

###	å‚è€ƒï¼š

1. [Setup Cloudflare CDN protected Trojan-Go with Docker on Ubuntu 20.04 (thematrix.dev)](https://thematrix.dev/setup-cloudflare-cdn-protected-trojan-go-using-docker-on-ubuntu-20-04/)
2. [Network configuration - ArchWiki (archlinux.org)](https://wiki.archlinux.org/title/Network_configuration#Change_interface_name)
3. [ç¿»å¢™ - DNSæ±¡æŸ“çš„åŸç†ä»¥åŠåº”å¯¹ç­–ç•¥ - DEV Community ğŸ‘©â€ğŸ’»ğŸ‘¨â€ğŸ’»](https://dev.to/metalage303/fan-qiang-dnswu-ran-de-yuan-li-yi-ji-ying-dui-ce-lue-3em)
4. [é€æ˜ä»£ç† | æ–° V2Ray ç™½è¯æ–‡æŒ‡å— (v2fly.org)](https://guide.v2fly.org/app/transparent_proxy.html#è®¾ç½®æ­¥éª¤)
5. [Netplan](https://netplan.io/reference#dhcp-overrides)
6. [Network bridge - ArchWiki (archlinux.org)](https://wiki.archlinux.org/title/network_bridge)
7. [dnsmasq - Debian Wiki](https://wiki.debian.org/dnsmasq)
8. [dnscrypt-proxy - ArchWiki (archlinux.org)](https://wiki.archlinux.org/title/Dnscrypt-proxy)
9. [Linux Kernel Documentation / networking / tproxy.txt (mjmwired.net)](https://mjmwired.net/kernel/Documentation/networking/tproxy.txt)
10. [Linux TPROXY - æµ®äº‘å¯è®°å¾—æ‹œ - åšå®¢å›­ (cnblogs.com)](https://www.cnblogs.com/gailtang/p/11200388.html)
11. [IPTables: Fun with MARK Â« bits | andy smith's blog](https://andys.org.uk/bits/2010/01/27/iptables-fun-with-mark/comment-page-1/)
12. [4.8. Routing Tables (linux-ip.net)](http://linux-ip.net/html/routing-tables.html)
13. [æ ‘è“æ´¾ + V2Ray é…ç½®é€æ˜ç½‘å…³ - YFDou](https://www.yfdou.com/archives/raspberrypi-v2ray-tproxy-gateway.html)

